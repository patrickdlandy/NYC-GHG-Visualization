<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="./dist/main.css">
    <script src="./dist/main.js"></script>
    <title>NYC GHG Visualization</title>
    <!-- Load D3 Library here. -->
    <script src="https://d3js.org/d3.v5.min.js" charset="utf-8"></script>
</head>
<body>
    <h1>NYC Greenhouse Gas Inventory</h1>
    <!-- <svg class="pie-chart"></svg> -->
    <main>
        <div id="chart"></div>
    </main>
    <script>
        //My initial D3 Code goes here:

        //dimensions

        const width = 550;
        const height = 550;
        const radius = width / 2;

        //Breadcrumb dimensions: width, height, spacing, width of tip/tail

        var b = {
            w: 75, h: 30, s: 3, t: 10
        };

        //ordinal color scale
        var colors = d3.scale.category20();

        //set later
        var totalSize = 0;

        var dataset = d3.json("./data/data.json").then(function (data) {
                return data;
            });

        dataset.then(function(data) {
            //any code referring to the dataset must go here because in
            //D3 v5 dataset is a promise!

            // console.log(data);

            //root hierarchy
            // var firstRoot = d3.hierarchy(data);
            // console.log(firstRoot);

            var vis = d3.select("#chart").append("svg")
                .attr("width", width)
                .attr("height", height)
                .append("g")
                .attr("id", "container")
                .attr("transform", "translate(" + width / 2 + "," + height / 2 + ")");

            var partition = d3.layout.partition()
                .size([2 * Math.PI, 100])
                .value(function (d) {
                    return d.size;
                });

            var arc = d3.arc()
                .startAngle(function(d) { return d.x; })
                .endAngle(function(d) { return d.x + d.dx })
                .innerRadius(function(d) { return innerR(d); })
                .outerRadius(function(d) { return outerR(d); });

            function innerR(d) {
                return radius * Math.sqrt(d.y) / 10;
            }

            function outerR(d) {
                return radius * math.sqrt(d.y + d.dy) / 10 - 8;
            }

            function createVisualization(json) {

                //setup page elements (later)

                vis.append("circle")
                    .attr("r", radius)
                    .style("opacity", 0);
                

                var nodes = partition.nodes(json)
                    .filter(function(d) {
                        return (d.dx > 0.005);
                    });

                var uniqueNames = (function(a) {
                    var output = [];
                    a.forEach(function(d) {
                        if (output.indexOf(d.name) === -1 ) {
                            output.push(d.name);
                        }
                    });
                    return output;
                })(nodes);

                // set domain of colors scale based on data
                colors.domain(uniqueNames);

                //draw legend here later

                var path = vis.data([data]).selectAll("path")
                    .data(nodes)
                    .enter()
                    .append("path")

            }

            createVisualization(data);
            
        }

            

    </script>
    
</body>
</html>