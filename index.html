<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="./dist/main.css">
    <script src="./dist/main.js"></script>
    <title>NYC GHG Visualization</title>
    <!-- Load D3 Library here. -->
    <script src="https://d3js.org/d3.v5.min.js" charset="utf-8"></script>
    <!-- <script src="https://d3js.org/d3-color.v1.min.js"></script>
    <script src="https://d3js.org/d3-interpolate.v1.min.js"></script>
    <script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script> -->

</head>
<body>
    <h1>NYC Greenhouse Gas Inventory</h1>
    <!-- <svg class="pie-chart"></svg> -->
    <main>
        <svg id="chart" width="932" height="932" viewBox="0 0 932 932"></svg>
    </main>
    <script>
        //My initial D3 Code goes here:

        //I need to define some constants for dimensions.
        const width = 900;
        const height = 900;
        const radius = width / 6;

        //I need to make an arc function and a partition function to be called later.


        //arc

        const arc = d3.arc()
            .startAngle(function(d) {
                return d.x0;
            })
            .endAngle(function(d) {
                return d.x1;
            })
            .padAngle(function(d) {
                return Math.min((d.x1 - d.x0) / 2, 0.005);
            })
            .padRadius(function() {
                return radius * 1.5;
            })
            .innerRadius(function(d) {
                // return 3;
                return d.y0 * radius;
            })
            .outerRadius(function(d) {
                return Math.max(d.y0 * radius, d.y1 * radius - 1);
            });

        //partition
        const partition = function(data) {
            const root = d3.hierarchy(data)
                    .sum(function(d) {
                        return d.size;
                    })
                    .sort(function(a, b) {
                        return(b.value - a.value);
                    })
                    console.log(root);
            return d3.partition()
                    .size([2* Math.PI, root.height + 1])
                    (root);
        }

        
        
        


        //I already know how to get my json data into an object in this function:

        var dataset = d3.json('/data/data.json').then( function(data) {
            return data;
        });

        dataset.then(function(data) {
            console.log(data)
            //All code to do visualization goes inside of this callback

            //color
            const color = d3.scaleOrdinal().range(d3.quantize(d3.interpolateRainbow,
            data.children.length + 1));

            //generate root 
            const root = partition(data);
            console.log(root.descendants());

            //set current attribute
            root.each(function(d) {
                d.current = d;
            });
            console.log(root.descendants());


            const svg = d3.select("#chart")
                .style("width", "100%")
                .style("height", "auto")
                .style("font", "10px sans-serif");
                
            const g = svg.append("g")
                .attr("transform", `translate(${width / 2}, ${width / 2})`);

            const path = g.append("g")
                    .selectAll("path")
                    .data(root.descendants())
                    .join("path")
                    .attr("fill", function(d) {
                        while (d.depth > 1)
                            { d = d.parent; }
                        return color(d.data.name);
                    })
                    .attr("fill-opacity", 1)
                    .attr("d", function(d) {
                        return arc(d.current);
                    });
                    

            //

        });


    </script>
    
</body>
</html>